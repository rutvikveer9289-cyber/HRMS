<div class="management-container animate__animated animate__fadeIn">
  <div class="header-section">
    <div class="title-group">
      <h2>Employee Master Management</h2>
      <p>View, edit, or remove employee records from the system.</p>
    </div>
    <div class="search-box">
      <i data-lucide="search"></i>
      <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="filterEmployees()"
        placeholder="Search by name, ID..." />
    </div>
  </div>

  <div class="table-card">
    <table class="employee-table">
      <thead>
        <tr>
          <th>Emp ID</th>
          <th>Name</th>
          <th class="mobile-hide">Email</th>
          <th>Phone</th>
          <th class="mobile-hide">Designation</th>
          <th>Bank Details</th>
          <th *ngIf="canEdit">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let emp of filteredEmployees">
          <td>
            <ng-container *ngIf="editingEmployee?.id !== emp.id">
              <span class="badge-id">{{ emp.emp_id }}</span>
            </ng-container>
            <div *ngIf="editingEmployee?.id === emp.id" class="badge-id opacity-70">{{ editingEmployee.emp_id }}</div>
          </td>
          <td>
            <ng-container *ngIf="editingEmployee?.id !== emp.id">
              {{ emp.full_name }}
            </ng-container>
            <div *ngIf="editingEmployee?.id === emp.id" class="read-only-text">{{ editingEmployee.full_name }}</div>
          </td>
          <td class="mobile-hide">
            <ng-container *ngIf="editingEmployee?.id !== emp.id">
              {{ emp.email }}
            </ng-container>
            <div *ngIf="editingEmployee?.id === emp.id" class="read-only-text">{{ editingEmployee.email }}</div>
          </td>
          <td>
            <ng-container *ngIf="editingEmployee?.id !== emp.id">
              {{ emp.phone_number }}
            </ng-container>
            <input *ngIf="editingEmployee?.id === emp.id" [(ngModel)]="editingEmployee.phone_number"
              class="edit-input" />
          </td>
          <td class="mobile-hide">
            <ng-container *ngIf="editingEmployee?.id !== emp.id">
              <span class="designation-cell">{{ emp.designation }}</span>
            </ng-container>
            <input *ngIf="editingEmployee?.id === emp.id" [(ngModel)]="editingEmployee.designation"
              class="edit-input" />
          </td>
          <td>
            <div class="bank-view" *ngIf="editingEmployee?.id !== emp.id">
              <div *ngIf="emp.bank_name"><strong>{{ emp.bank_name }}</strong></div>
              <div *ngIf="emp.bank_account_no">{{ emp.bank_account_no }}</div>
              <div *ngIf="emp.bank_ifsc_code" class="text-xs text-slate-500">{{ emp.bank_ifsc_code }}</div>
              <span *ngIf="!emp.bank_name && !emp.bank_account_no" class="text-slate-400 italic">No details</span>
            </div>
            <div class="bank-edit" *ngIf="editingEmployee?.id === emp.id">
              <input [(ngModel)]="editingEmployee.bank_name" placeholder="Bank Name" class="edit-input-sm" />
              <input [(ngModel)]="editingEmployee.bank_account_no" placeholder="Account No" class="edit-input-sm" />
              <input [(ngModel)]="editingEmployee.bank_ifsc_code" placeholder="IFSC Code" class="edit-input-sm" />
            </div>
          </td>
          <td class="actions-cell" *ngIf="canEdit">
            <div class="action-buttons" *ngIf="editingEmployee?.id !== emp.id">
              <button class="btn-icon docs" (click)="manageDocuments(emp)" title="Documents">
                <i data-lucide="files"></i>
              </button>
              <button class="btn-icon edit" (click)="editEmployee(emp)" title="Edit">
                <i data-lucide="pencil"></i>
              </button>
              <button class="btn-icon delete" (click)="deleteEmployee(emp.id)" title="Delete">
                <i data-lucide="trash-2"></i>
              </button>
            </div>
            <div class="action-buttons" *ngIf="editingEmployee?.id === emp.id">
              <button class="btn-icon save" (click)="saveEmployee()" title="Save">
                <i data-lucide="check-circle"></i>
              </button>
              <button class="btn-icon cancel" (click)="cancelEdit()" title="Cancel">
                <i data-lucide="x-circle"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="empty-state" *ngIf="filteredEmployees.length === 0">
      <i class="lucide-users"></i>
      <p>No employees found matching your search.</p>
    </div>
  </div>

  <!-- Document Management Modal -->
  <div class="modal-overlay" *ngIf="isDocModalOpen" (click)="closeDocModal()">
    <div class="doc-modal animate__animated animate__zoomIn" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title">
          <i data-lucide="folder-open"></i>
          <div>
            <h3>Digital Repository</h3>
            <p>{{ activeEmployee?.full_name }} ({{ activeEmployee?.emp_id }})</p>
          </div>
        </div>
        <button class="btn-close" (click)="closeDocModal()">&times;</button>
      </div>

      <div class="modal-body">
        <div class="doc-grid">
          <div class="doc-card" *ngFor="let type of docTypes" [class.has-file]="hasDoc(type.key)">
            <div class="doc-info">
              <span class="doc-label">{{ type.label }}</span>
              <div class="doc-status" *ngIf="hasDoc(type.key)">
                <i data-lucide="check-circle"></i>
                <span>{{ getDocName(type.key) }}</span>
              </div>
              <div class="doc-status pending" *ngIf="!hasDoc(type.key)">
                <i data-lucide="alert-circle"></i>
                <span>Submission Required</span>
              </div>
            </div>

            <div class="doc-actions">
              <input type="file" #fileInput (change)="uploadDoc($event, type.key)" hidden>
              <button class="btn-upload" (click)="fileInput.click()" *ngIf="!hasDoc(type.key)"
                [disabled]="isDocUploading">
                <i data-lucide="upload"></i>
                Select File
              </button>
              <button class="btn-delete" (click)="deleteDoc(getDocId(type.key))" *ngIf="hasDoc(type.key)">
                <i data-lucide="trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>